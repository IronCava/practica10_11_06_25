
<%- include('partials/_head') %>
<h2>Formulario de registro</h2>

<% 
  const _errors = (typeof errors !== 'undefined' && errors) ? errors : null;
  const _old    = (typeof old    !== 'undefined' && old)    ? old    : {};
%>

<% if (_errors) { %>
  <ul class="form-errors" style="color:red; font-weight:bold; margin-bottom:10px;">
    <% Object.values(_errors).forEach(e => { %>
      <li><%= e.msg %></li>
    <% }) %>
  </ul>
<% } %>

<form action="/register" method="POST">
  <label for="user">Usuario (email)</label>
<input type="email" name="user" value="<%= _old.user || '' %>" required autofocus />
  <% if (_errors && _errors.user) { %>
    <small style="color:red;"><%= _errors.user.msg %></small>
  <% } %>

  <label for="name">Nombre</label>
  <input type="text" name="name" value="<%= _old.name || '' %>" required />
  <% if (_errors && _errors.name) { %>
    <small style="color:red;"><%= _errors.name.msg %></small>
  <% } %>

  <label for="apellidos">Apellidos</label>
  <input type="text" name="apellidos" value="<%= _old.apellidos || '' %>" required />
  <% if (_errors && _errors.apellidos) { %>
    <small style="color:red;"><%= _errors.apellidos.msg %></small>
  <% } %>

  <label for="rol">Rol</label>
  <select name="rol" class="select-css" required>
    <option value="admin"  <%= _old.rol === 'admin'  ? 'selected' : '' %>>Admin</option>
    <option value="editor" <%= _old.rol === 'editor' ? 'selected' : '' %>>Editor</option>
  </select>
  <% if (_errors && _errors.rol) { %>
    <small style="color:red;"><%= _errors.rol.msg %></small>
  <% } %>

  <label for="pass">Contraseña</label>
  <input type="password" name="pass" required />
  <% if (_errors && _errors.pass) { %>
    <small style="color:red;"><%= _errors.pass.msg %></small>
  <% } %>

  <div class="inline">
    <a href="/" class="btn-cancel">Cancelar</a>
    <input type="submit" value="Guardar" class="btn-save" />
  </div>
</form>

<% /* SweetAlert de éxito (solo si alert está definido) */ %>
<% if (typeof alert !== "undefined") { %>
  <script>
    Swal.fire({
      title: '<%= alertTitle %>',
      text: '<%= alertMessage %>',
      icon: '<%= alertIcon %>',
      showConfirmButton: <%= showConfirmButton %>,
      timer: <%= timer %>
    }).then(() => {
      window.location = '/<%= ruta %>';
    });
  </script>
<% } %>
<%- include('partials/_foot') %>